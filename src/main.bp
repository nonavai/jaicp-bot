# –û—Å–Ω–æ–≤–Ω–æ–π J-Graph —Ñ–∞–π–ª –¥–ª—è –∞–≤—Ç–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ —á–∞—Ç-–±–æ—Ç–∞

# –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
state: greeting
  q: q:greeting
  a: >
    –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∞–≤—Ç–æ—Å–µ—Ä–≤–∏—Å "–ê–≤—Ç–æ–ü—Ä–æ—Ñ–∏".
    
    –Ø –ø–æ–º–æ–≥—É –≤–∞–º:
    ‚Ä¢ –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —Ç–µ—Ö–æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ
    ‚Ä¢ –£–∑–Ω–∞—Ç—å —Ü–µ–Ω—ã –Ω–∞ —É—Å–ª—É–≥–∏
    ‚Ä¢ –£–∑–Ω–∞—Ç—å —á–∞—Å—ã —Ä–∞–±–æ—Ç—ã
    ‚Ä¢ –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é
    
    –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?

# –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ—â–∞–Ω–∏—è
state: farewell
  q: q:farewell
  a: >
    –°–ø–∞—Å–∏–±–æ –∑–∞ –æ–±—Ä–∞—â–µ–Ω–∏–µ –≤ –∞–≤—Ç–æ—Å–µ—Ä–≤–∏—Å "–ê–≤—Ç–æ–ü—Ä–æ—Ñ–∏"!
    
    –ï—Å–ª–∏ —É –≤–∞—Å –ø–æ—è–≤—è—Ç—Å—è –≤–æ–ø—Ä–æ—Å—ã, –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è.
    –•–æ—Ä–æ—à–µ–≥–æ –¥–Ω—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –¥–æ—Ä–æ–≥!
    
    –î–æ —Å–≤–∏–¥–∞–Ω–∏—è!

# –°–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ —á–∞—Å–æ–≤ —Ä–∞–±–æ—Ç—ã
state: working_hours
  q: q:working_hours
  a: >
    üìÖ –ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã –∞–≤—Ç–æ—Å–µ—Ä–≤–∏—Å–∞ "–ê–≤—Ç–æ–ü—Ä–æ—Ñ–∏":
    
    üöó –ü—Ä–∏–µ–º –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π:
    ‚Ä¢ –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ - –ü—è—Ç–Ω–∏—Ü–∞: 8:00 - 20:00
    ‚Ä¢ –°—É–±–±–æ—Ç–∞: 9:00 - 18:00
    ‚Ä¢ –í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ: 10:00 - 16:00
    
    üîß –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç:
    ‚Ä¢ –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ - –ü—è—Ç–Ω–∏—Ü–∞: 8:00 - 19:00
    ‚Ä¢ –°—É–±–±–æ—Ç–∞: 9:00 - 17:00
    ‚Ä¢ –í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ: 10:00 - 15:00
    
    ‚ö° –≠–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è –ø–æ–º–æ—â—å: –∫—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ
    
    üìû –ó–∞–ø–∏—Å—å –Ω–∞ –¢–û –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è –≤ —Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã.
    –ï—Å—Ç—å –ª–∏ –µ—â–µ –≤–æ–ø—Ä–æ—Å—ã?

# –°–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ —Ü–µ–Ω
state: price_inquiry
  q: q:price_inquiry
  a: >
    üí∞ –¶–µ–Ω—ã –Ω–∞ —É—Å–ª—É–≥–∏ –∞–≤—Ç–æ—Å–µ—Ä–≤–∏—Å–∞ "–ê–≤—Ç–æ–ü—Ä–æ—Ñ–∏":
    
    üîß –¢–µ—Ö–æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ (–¢–û):
    ‚Ä¢ –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏: –æ—Ç 2,500 ‚ÇΩ
    ‚Ä¢ –°—Ä–µ–¥–Ω–∏–µ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏: –æ—Ç 3,500 ‚ÇΩ
    ‚Ä¢ –ö—Ä—É–ø–Ω—ã–µ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏: –æ—Ç 4,500 ‚ÇΩ
    ‚Ä¢ –ü—Ä–µ–º–∏—É–º –∫–ª–∞—Å—Å: –æ—Ç 6,000 ‚ÇΩ
    
    üöó –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:
    ‚Ä¢ –ö–æ–º–ø—å—é—Ç–µ—Ä–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞: –æ—Ç 1,500 ‚ÇΩ
    ‚Ä¢ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–æ–¥–≤–µ—Å–∫–∏: –æ—Ç 800 ‚ÇΩ
    ‚Ä¢ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –¥–≤–∏–≥–∞—Ç–µ–ª—è: –æ—Ç 1,200 ‚ÇΩ
    
    üõ†Ô∏è –†–µ–º–æ–Ω—Ç–Ω—ã–µ —Ä–∞–±–æ—Ç—ã:
    ‚Ä¢ –ó–∞–º–µ–Ω–∞ –º–∞—Å–ª–∞: –æ—Ç 800 ‚ÇΩ
    ‚Ä¢ –ó–∞–º–µ–Ω–∞ —Ç–æ—Ä–º–æ–∑–Ω—ã—Ö –∫–æ–ª–æ–¥–æ–∫: –æ—Ç 1,500 ‚ÇΩ
    ‚Ä¢ –ó–∞–º–µ–Ω–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤: –æ—Ç 400 ‚ÇΩ
    
    üí° –¢–æ—á–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –º–æ–∂–Ω–æ —É–∑–Ω–∞—Ç—å –ø–æ—Å–ª–µ –æ—Å–º–æ—Ç—Ä–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª—è.
    –•–æ—Ç–∏—Ç–µ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –¢–û?

# –°–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –Ω–∞ —Ç–µ—Ö–æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ
state: service_booking
  q: q:service_booking
  script:
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–∫–æ–ª—å–∫–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —É –Ω–∞—Å –µ—Å—Ç—å
    var params = 0;
    if ($parseTree._name) params++;
    if ($parseTree._phone) params++;
    if ($parseTree._brand) params++;
    
    # –ï—Å–ª–∏ –µ—Å—Ç—å 2 –∏–ª–∏ –±–æ–ª—å—à–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—é
    if (params >= 2) {
      $session.bookingData = {
        name: $parseTree._name || $session.bookingData.name,
        phone: $parseTree._phone || $session.bookingData.phone,
        brand: $parseTree._brand || $session.bookingData.brand
      };
      $reactions.transition("confirm_booking");
    } else {
      # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ, —á—Ç–æ –µ—Å—Ç—å
      if ($parseTree._name) $session.bookingData.name = $parseTree._name;
      if ($parseTree._phone) $session.bookingData.phone = $parseTree._phone;
      if ($parseTree._brand) $session.bookingData.brand = $parseTree._brand;
      
      # –û–ø—Ä–µ–¥–µ–ª—è–µ–º, —á—Ç–æ –Ω—É–∂–Ω–æ —Å–ø—Ä–æ—Å–∏—Ç—å
      if (!$session.bookingData.name) {
        $reactions.transition("ask_name");
      } else if (!$session.bookingData.phone) {
        $reactions.transition("ask_phone");
      } else if (!$session.bookingData.brand) {
        $reactions.transition("ask_car_brand");
      }
    }

# –°–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –∏–º–µ–Ω–∏
state: ask_name
  q: * @FullName *
  script:
    $session.bookingData.name = $parseTree._name;
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –µ—â–µ –Ω—É–∂–Ω–æ
    if (!$session.bookingData.phone) {
      $reactions.transition("ask_phone");
    } else if (!$session.bookingData.brand) {
      $reactions.transition("ask_car_brand");
    } else {
      $reactions.transition("confirm_booking");
    }

# –°–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
state: ask_phone
  q: * @Phone *
  script:
    $session.bookingData.phone = $parseTree._phone;
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –µ—â–µ –Ω—É–∂–Ω–æ
    if (!$session.bookingData.name) {
      $reactions.transition("ask_name");
    } else if (!$session.bookingData.brand) {
      $reactions.transition("ask_car_brand");
    } else {
      $reactions.transition("confirm_booking");
    }

# –°–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –º–∞—Ä–∫–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª—è
state: ask_car_brand
  q: * @CarBrand *
  script:
    $session.bookingData.brand = $parseTree._brand;
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –µ—â–µ –Ω—É–∂–Ω–æ
    if (!$session.bookingData.name) {
      $reactions.transition("ask_name");
    } else if (!$session.bookingData.phone) {
      $reactions.transition("ask_phone");
    } else {
      $reactions.transition("confirm_booking");
    }

# –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏
state: confirm_booking
  a: >
    üìã –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–ø–∏—Å–∏ –Ω–∞ —Ç–µ—Ö–æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ:
    
    üë§ –ò–º—è: {{ $session.bookingData.name }}
    üì± –¢–µ–ª–µ—Ñ–æ–Ω: {{ $session.bookingData.phone }}
    üöó –ê–≤—Ç–æ–º–æ–±–∏–ª—å: {{ $session.bookingData.brand }}
    
    –í—Å–µ –≤–µ—Ä–Ω–æ? –ï—Å–ª–∏ –Ω—É–∂–Ω–æ —á—Ç–æ-—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—å, —Å–∫–∞–∂–∏—Ç–µ.

# –°–æ—Å—Ç–æ—è–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
state: process_confirmation
  q: * @Confirmation *
  script:
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ backend
    $reactions.transition("send_booking_request");

# –°–æ—Å—Ç–æ—è–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞—è–≤–∫–∏
state: send_booking_request
  httpAction:
    url: "http://localhost:5000/api/booking"
    method: "POST"
    body: >
      {
        "userId": "{{ $userId }}",
        "name": "{{ $session.bookingData.name }}",
        "phone": "{{ $session.bookingData.phone }}",
        "carBrand": "{{ $session.bookingData.brand }}",
        "timestamp": "{{ new Date().toISOString() }}"
      }
    headers:
      Content-Type: "application/json"
    success:
      # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —É—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç
      script:
        var response = JSON.parse($httpResponse);
        if (response.success) {
          $reactions.transition("booking_success");
        } else {
          $reactions.transition("error_handling");
        }
    error:
      # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—à–∏–±–∫—É
      $reactions.transition("error_handling");

# –°–æ—Å—Ç–æ—è–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–ø–∏—Å–∏
state: booking_success
  a: >
    ‚úÖ –ó–∞—è–≤–∫–∞ –Ω–∞ —Ç–µ—Ö–æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∞!
    
    üìã –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ:
    üë§ –ò–º—è: {{ $session.bookingData.name }}
    üì± –¢–µ–ª–µ—Ñ–æ–Ω: {{ $session.bookingData.phone }}
    üöó –ê–≤—Ç–æ–º–æ–±–∏–ª—å: {{ $session.bookingData.brand }}
    
    üìû –ù–∞—à —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π –∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏.
    
    üïê –û–±—ã—á–Ω–æ –º—ã –ø–µ—Ä–µ–∑–≤–∞–Ω–∏–≤–∞–µ–º –≤ —Ç–µ—á–µ–Ω–∏–µ 1-2 —á–∞—Å–æ–≤ –≤ —Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è.
    
    –ï—Å—Ç—å –ª–∏ –µ—â–µ –≤–æ–ø—Ä–æ—Å—ã?

# –°–æ—Å—Ç–æ—è–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–∫–∏
state: error_handling
  a: >
    –ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –≤–∞—à–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.
    
    –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –Ω–∞—à–µ–º—É –º–µ–Ω–µ–¥–∂–µ—Ä—É –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É.
    
    –ß–µ–º –µ—â–µ –º–æ–≥—É –ø–æ–º–æ—á—å?

# –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (fallback)
state: default
  a: >
    –ò–∑–≤–∏–Ω–∏—Ç–µ, —è –Ω–µ —Å–æ–≤—Å–µ–º –ø–æ–Ω—è–ª –≤–∞—à –∑–∞–ø—Ä–æ—Å.
    
    –Ø –º–æ–≥—É –ø–æ–º–æ—á—å –≤–∞–º:
    ‚Ä¢ –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —Ç–µ—Ö–æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ
    ‚Ä¢ –£–∑–Ω–∞—Ç—å —Ü–µ–Ω—ã –Ω–∞ —É—Å–ª—É–≥–∏
    ‚Ä¢ –£–∑–Ω–∞—Ç—å —á–∞—Å—ã —Ä–∞–±–æ—Ç—ã
    ‚Ä¢ –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é
    
    –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å –±–æ–ª–µ–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ.